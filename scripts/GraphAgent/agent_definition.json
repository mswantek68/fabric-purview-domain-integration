{
  "name": "DocumentDiscoveryAgent",
  "description": "AI agent for discovering and summarizing organizational documents from Microsoft Graph",
  "version": "1.0.0",
  "created": "2024-09-17T00:00:00Z",
  "agent_type": "conversational",
  "capabilities": [
    "document_search",
    "content_summarization", 
    "organizational_analysis",
    "adaptive_interaction"
  ],
  "configuration": {
    "ai_foundry": {
      "model_name": "gpt-4",
      "temperature": 0.3,
      "max_tokens": 2000,
      "system_prompt": "You are an expert document discovery agent that helps users find, analyze, and summarize organizational documents. You can search across SharePoint, OneDrive, and Teams to discover relevant content based on organization names, domains, or topics. You provide structured summaries with key insights, decisions, and actionable items."
    },
    "graph_integration": {
      "scopes": [
        "Files.Read.All",
        "Sites.Read.All",
        "Directory.Read.All",
        "Chat.Read.All",
        "ChannelMessage.Read.All"
      ],
      "supported_sources": ["SharePoint", "OneDrive", "Teams"],
      "supported_file_types": ["docx", "xlsx", "pptx", "pdf"]
    },
    "search_parameters": {
      "default_days_back": 90,
      "max_results_per_term": 50,
      "relevance_threshold": 0.7
    }
  },
  "tools": [
    {
      "name": "extract_domain_metadata",
      "description": "Extract organizational identifiers from Fabric lakehouse metadata",
      "script_path": "./01_extract_domain_metadata.ps1",
      "input_schema": {
        "type": "object",
        "properties": {
          "lakehouse_name": {"type": "string"},
          "workspace_name": {"type": "string"},
          "purview_account": {"type": "string"}
        }
      },
      "output_schema": {
        "type": "object", 
        "properties": {
          "extracted_domains": {"type": "array", "items": {"type": "string"}},
          "graph_search_terms": {"type": "array"}
        }
      }
    },
    {
      "name": "search_graph_documents",
      "description": "Search Microsoft Graph for documents mentioning organization names",
      "script_path": "./02_search_graph_documents.ps1",
      "input_schema": {
        "type": "object",
        "properties": {
          "search_terms": {"type": "string"},
          "file_types": {"type": "string", "default": "docx,xlsx,pptx,pdf"},
          "days_back": {"type": "integer", "default": 90},
          "max_results": {"type": "integer", "default": 50}
        }
      },
      "output_schema": {
        "type": "object",
        "properties": {
          "results": {"type": "array"},
          "statistics": {"type": "object"}
        }
      }
    },
    {
      "name": "summarize_documents", 
      "description": "Generate AI-powered summaries of discovered documents",
      "script_path": "./03_summarize_documents.ps1",
      "input_schema": {
        "type": "object",
        "properties": {
          "input_file": {"type": "string"},
          "output_format": {"type": "string", "enum": ["markdown", "json", "both"], "default": "both"},
          "max_documents": {"type": "integer", "default": 50}
        }
      },
      "output_schema": {
        "type": "object",
        "properties": {
          "summaries": {"type": "array"},
          "statistics": {"type": "object"}
        }
      }
    },
    {
      "name": "ingest_lakehouse",
      "description": "Ingest document summaries into Fabric lakehouse",
      "script_path": "./04_ingest_lakehouse.ps1", 
      "input_schema": {
        "type": "object",
        "properties": {
          "input_file": {"type": "string"},
          "lakehouse_name": {"type": "string"},
          "workspace_name": {"type": "string"},
          "table_name": {"type": "string", "default": "document_summaries"},
          "update_mode": {"type": "string", "enum": ["append", "overwrite", "merge"], "default": "append"}
        }
      },
      "output_schema": {
        "type": "object",
        "properties": {
          "ingestion_result": {"type": "object"},
          "statistics": {"type": "object"}
        }
      }
    }
  ],
  "workflows": [
    {
      "name": "full_document_discovery",
      "description": "Complete end-to-end document discovery and analysis workflow",
      "steps": [
        {
          "step": 1,
          "name": "extract_metadata",
          "tool": "extract_domain_metadata",
          "description": "Extract organizational identifiers from lakehouse metadata"
        },
        {
          "step": 2, 
          "name": "search_documents",
          "tool": "search_graph_documents",
          "description": "Search Microsoft Graph for relevant documents",
          "depends_on": ["extract_metadata"]
        },
        {
          "step": 3,
          "name": "generate_summaries", 
          "tool": "summarize_documents",
          "description": "Generate AI summaries of discovered documents",
          "depends_on": ["search_documents"]
        },
        {
          "step": 4,
          "name": "ingest_data",
          "tool": "ingest_lakehouse", 
          "description": "Store summaries in Fabric lakehouse",
          "depends_on": ["generate_summaries"]
        }
      ]
    },
    {
      "name": "quick_search",
      "description": "Quick document search with basic summarization",
      "steps": [
        {
          "step": 1,
          "name": "search_documents",
          "tool": "search_graph_documents",
          "description": "Search for documents using provided terms"
        },
        {
          "step": 2,
          "name": "generate_summaries",
          "tool": "summarize_documents", 
          "description": "Summarize top results",
          "depends_on": ["search_documents"]
        }
      ]
    },
    {
      "name": "metadata_only",
      "description": "Extract domain metadata without document search",
      "steps": [
        {
          "step": 1,
          "name": "extract_metadata",
          "tool": "extract_domain_metadata",
          "description": "Extract organizational identifiers only"
        }
      ]
    }
  ],
  "conversation_patterns": [
    {
      "intent": "discover_documents",
      "patterns": [
        "find documents about {organization}",
        "search for files mentioning {company}",
        "discover content related to {domain}",
        "what documents reference {organization_name}"
      ],
      "workflow": "full_document_discovery",
      "response_template": "I'll help you discover documents related to {organization}. Let me search across SharePoint, OneDrive, and Teams to find relevant content and provide you with intelligent summaries."
    },
    {
      "intent": "quick_search",
      "patterns": [
        "quickly find {search_term}",
        "search for {topic}",
        "look up {keyword}",
        "find files about {subject}"
      ],
      "workflow": "quick_search", 
      "response_template": "I'll perform a quick search for '{search_term}' across your organization's documents and provide summaries of the most relevant findings."
    },
    {
      "intent": "analyze_organization",
      "patterns": [
        "analyze documents for {organization}",
        "what does our content say about {company}",
        "summarize organizational references to {domain}",
        "extract insights about {organization_name}"
      ],
      "workflow": "full_document_discovery",
      "response_template": "I'll analyze your organization's documents for references to {organization} and provide comprehensive insights including key decisions, action items, and organizational relationships."
    },
    {
      "intent": "extract_domains",
      "patterns": [
        "what organizations are in our data",
        "extract domain names from lakehouse",
        "find organizational identifiers",
        "discover company references in metadata"
      ],
      "workflow": "metadata_only",
      "response_template": "I'll analyze your Fabric lakehouse metadata to identify organizational domains and entities that can be used for targeted document searches."
    }
  ],
  "adaptive_cards": [
    {
      "name": "search_parameters_card",
      "title": "Document Search Parameters", 
      "description": "Configure your document search parameters",
      "card_schema": {
        "type": "AdaptiveCard",
        "version": "1.3",
        "body": [
          {
            "type": "TextBlock",
            "text": "Document Search Configuration",
            "weight": "Bolder",
            "size": "Medium"
          },
          {
            "type": "Input.Text",
            "id": "search_terms",
            "label": "Search Terms (comma-separated)",
            "placeholder": "e.g., Contoso, Fabrikam, Microsoft",
            "isRequired": true
          },
          {
            "type": "Input.ChoiceSet",
            "id": "file_types",
            "label": "File Types to Search",
            "isMultiSelect": true,
            "value": "docx,xlsx,pptx,pdf",
            "choices": [
              {"title": "Word Documents", "value": "docx"},
              {"title": "Excel Spreadsheets", "value": "xlsx"}, 
              {"title": "PowerPoint Presentations", "value": "pptx"},
              {"title": "PDF Documents", "value": "pdf"}
            ]
          },
          {
            "type": "Input.Number",
            "id": "days_back",
            "label": "Search Period (days back)",
            "value": 90,
            "min": 1,
            "max": 365
          },
          {
            "type": "Input.Number", 
            "id": "max_results",
            "label": "Maximum Results per Search Term",
            "value": 50,
            "min": 10,
            "max": 200
          },
          {
            "type": "Input.ChoiceSet",
            "id": "sources",
            "label": "Sources to Search",
            "isMultiSelect": true,
            "value": "SharePoint,OneDrive,Teams",
            "choices": [
              {"title": "SharePoint Sites", "value": "SharePoint"},
              {"title": "OneDrive Files", "value": "OneDrive"},
              {"title": "Teams Messages & Files", "value": "Teams"}
            ]
          }
        ],
        "actions": [
          {
            "type": "Action.Submit",
            "title": "Start Search",
            "data": {
              "action": "start_search"
            }
          },
          {
            "type": "Action.Submit", 
            "title": "Use Lakehouse Metadata",
            "data": {
              "action": "use_metadata"
            }
          }
        ]
      }
    },
    {
      "name": "search_results_card",
      "title": "Document Search Results",
      "description": "Display search results with summary options",
      "card_schema": {
        "type": "AdaptiveCard",
        "version": "1.3", 
        "body": [
          {
            "type": "TextBlock",
            "text": "Search Results: {result_count} documents found",
            "weight": "Bolder",
            "size": "Medium"
          },
          {
            "type": "FactSet",
            "facts": [
              {"title": "Search Terms", "value": "{search_terms}"},
              {"title": "Sources", "value": "{sources}"},
              {"title": "File Types", "value": "{file_types}"},
              {"title": "Date Range", "value": "{date_range}"}
            ]
          },
          {
            "type": "Container",
            "items": [
              {
                "type": "TextBlock",
                "text": "Top Results:",
                "weight": "Bolder"
              },
              {
                "type": "TextBlock", 
                "text": "{top_results}",
                "wrap": true
              }
            ]
          }
        ],
        "actions": [
          {
            "type": "Action.Submit",
            "title": "Generate Summaries",
            "data": {
              "action": "generate_summaries"
            }
          },
          {
            "type": "Action.Submit",
            "title": "Save to Lakehouse", 
            "data": {
              "action": "save_lakehouse"
            }
          },
          {
            "type": "Action.Submit",
            "title": "Refine Search",
            "data": {
              "action": "refine_search"
            }
          }
        ]
      }
    },
    {
      "name": "summary_results_card",
      "title": "Document Summaries",
      "description": "Display generated document summaries",
      "card_schema": {
        "type": "AdaptiveCard",
        "version": "1.3",
        "body": [
          {
            "type": "TextBlock", 
            "text": "Document Analysis Complete",
            "weight": "Bolder",
            "size": "Medium"
          },
          {
            "type": "FactSet",
            "facts": [
              {"title": "Documents Analyzed", "value": "{analyzed_count}"},
              {"title": "Successful Summaries", "value": "{success_count}"},
              {"title": "Processing Time", "value": "{processing_time}"},
              {"title": "AI Model Used", "value": "{model_name}"}
            ]
          },
          {
            "type": "Container",
            "items": [
              {
                "type": "TextBlock",
                "text": "Key Insights:",
                "weight": "Bolder"
              },
              {
                "type": "TextBlock",
                "text": "{key_insights}",
                "wrap": true
              }
            ]
          }
        ],
        "actions": [
          {
            "type": "Action.Submit",
            "title": "View Full Report",
            "data": {
              "action": "view_report"
            }
          },
          {
            "type": "Action.Submit",
            "title": "Export Results",
            "data": {
              "action": "export_results"  
            }
          },
          {
            "type": "Action.Submit",
            "title": "Start New Search",
            "data": {
              "action": "new_search"
            }
          }
        ]
      }
    }
  ],
  "teams_integration": {
    "bot_id": "document-discovery-agent",
    "app_id": "{TEAMS_APP_ID}",
    "supported_commands": [
      {
        "command": "search",
        "description": "Search for organizational documents",
        "usage": "@DocumentDiscoveryAgent search [organization_name]"
      },
      {
        "command": "analyze", 
        "description": "Analyze documents for specific organization",
        "usage": "@DocumentDiscoveryAgent analyze [organization_name]"
      },
      {
        "command": "domains",
        "description": "Extract organizational domains from lakehouse",
        "usage": "@DocumentDiscoveryAgent domains"
      },
      {
        "command": "help",
        "description": "Show available commands and capabilities",
        "usage": "@DocumentDiscoveryAgent help"
      }
    ],
    "manifest_template": {
      "$schema": "https://developer.microsoft.com/en-us/json-schemas/teams/v1.16/MicrosoftTeams.schema.json",
      "manifestVersion": "1.16",
      "version": "1.0.0",
      "id": "{TEAMS_APP_ID}",
      "packageName": "com.organization.documentdiscoveryagent",
      "developer": {
        "name": "Organization IT",
        "websiteUrl": "https://organization.com",
        "privacyUrl": "https://organization.com/privacy",
        "termsOfUseUrl": "https://organization.com/terms"
      },
      "icons": {
        "color": "icon-color.png",
        "outline": "icon-outline.png"
      },
      "name": {
        "short": "Document Discovery Agent",
        "full": "AI-Powered Document Discovery and Analysis Agent"
      },
      "description": {
        "short": "Find and analyze organizational documents across Microsoft 365",
        "full": "AI agent that discovers, analyzes, and summarizes organizational documents from SharePoint, OneDrive, and Teams using advanced natural language processing."
      },
      "accentColor": "#0078d4",
      "bots": [
        {
          "botId": "{BOT_ID}",
          "scopes": ["personal", "team", "groupchat"],
          "commandLists": [
            {
              "scopes": ["personal", "team", "groupchat"],
              "commands": [
                {
                  "title": "Search Documents",
                  "description": "Search for documents mentioning specific organizations"
                },
                {
                  "title": "Analyze Organization",
                  "description": "Comprehensive analysis of organizational references"
                },
                {
                  "title": "Extract Domains", 
                  "description": "Find organizational identifiers in lakehouse metadata"
                }
              ]
            }
          ]
        }
      ],
      "permissions": [
        "identity",
        "messageTeamMembers"
      ],
      "validDomains": [
        "organization.com",
        "*.azure.com"
      ]
    }
  },
  "security": {
    "authentication": {
      "type": "managed_identity",
      "scopes": [
        "https://graph.microsoft.com/.default",
        "https://cognitiveservices.azure.com/.default", 
        "https://analysis.windows.net/powerbi/api/.default"
      ]
    },
    "data_protection": {
      "encryption_at_rest": true,
      "encryption_in_transit": true,
      "data_retention_days": 90,
      "pii_detection": true
    },
    "access_control": {
      "rbac_enabled": true,
      "allowed_users": ["organization_members"],
      "restricted_content_types": ["confidential", "restricted"]
    }
  },
  "monitoring": {
    "logging": {
      "level": "INFO",
      "destinations": ["Azure_Monitor", "Fabric_Lakehouse"]
    },
    "metrics": [
      "search_requests",
      "documents_processed", 
      "summary_generation_time",
      "user_interactions",
      "error_rates"
    ],
    "alerts": [
      {
        "name": "high_error_rate",
        "condition": "error_rate > 0.1",
        "action": "notify_admin"
      },
      {
        "name": "quota_exceeded",
        "condition": "api_calls > daily_limit * 0.9", 
        "action": "throttle_requests"
      }
    ]
  },
  "deployment": {
    "environment": "production",
    "azure_resources": {
      "ai_foundry": "{AI_FOUNDRY_NAME}",
      "fabric_workspace": "{FABRIC_WORKSPACE_NAME}",
      "fabric_lakehouse": "{FABRIC_LAKEHOUSE_NAME}",
      "managed_identity": "{MANAGED_IDENTITY_ID}"
    },
    "scaling": {
      "auto_scale": true,
      "min_instances": 1,
      "max_instances": 10,
      "scale_trigger": "request_queue_length > 10"
    }
  }
}