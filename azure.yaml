name: ai-fabric-foundry
infra:
  provider: bicep
  module: main-with-modules
  parameters: main-with-modules.bicepparam
metadata:
  template: ''

# ========================================================================
# DEPLOYMENT ORDER (handled automatically by main-with-modules.bicep)
# ========================================================================
# The following operations are executed by AVM deployment script modules
# in dependency order. No manual hooks needed - all orchestrated in Bicep.
#
# Stage 1: Infrastructure Setup
# - Deploy storage account (for deployment scripts)
# - Deploy managed identity (for authentication)
# - Deploy Fabric capacity (or reference existing)
#
# Stage 2: Fabric Domain & Workspace Creation
# 1. ensureActiveCapacity - Verify capacity is active, resume if paused
# 2. fabricDomain - Create Fabric domain for governance
# 3. fabricWorkspace - Create Fabric workspace
# 4. assignWorkspaceToDomain - Assign workspace to domain
# 5. createLakehouses - Create bronze, silver, gold lakehouses
#
# Stage 3: Purview Integration (Governance & Scanning)
# 6. assignFabricRoles - Assign Fabric RBAC to managed identity
# 7. assignPurviewRoles - Assign Purview RBAC to managed identity
# 8. createPurviewCollection - Create collection in Purview Data Map
# 9. registerFabricDatasource - Register workspace as datasource in Purview
# 10. triggerPurviewScan - Trigger scan (if enablePurviewScan = true)
#
# Stage 4: Monitoring & Observability
# 11. connectLogAnalytics - Connect workspace to Log Analytics (if enabled)
#
# Stage 5: OneLake Index (Optional - AI Search Integration)
# - setupRBAC - Assign AI Search and AI Services RBAC
# - createSkillsets - Create AI skillsets for document processing
# - createDataSource - Configure OneLake as search data source
# - createIndex - Create search index schema
# - createIndexer - Create and run indexer
# ========================================================================
